---
description: File structure and colocalization guidelines for Next.js app router
globs: **/*.{ts,tsx}
alwaysApply: true
---

# File Structure

## Core Principle

**Colocate code at the route/page level.** Components, hooks, actions, and queries should live next to the page that uses them.

## Directory Structure

### ✅ Good: Colocated Structure

```
app/(app)/[orgId]/tasks/
├── page.tsx                    # Server component
├── components/
│   ├── TaskList.tsx            # Client component
│   ├── TaskCard.tsx
│   └── TaskFilters.tsx
├── hooks/
│   └── useTasks.ts             # SWR hook with mutations
├── data/
│   └── queries.ts              # Server-side queries
└── actions/
    └── task-actions.ts         # If needed
```

### ❌ Bad: Scattered Structure

```
app/(app)/[orgId]/tasks/page.tsx
components/tasks/TaskList.tsx      # ❌ Far from page
components/tasks/TaskCard.tsx      # ❌ Hard to find
hooks/useTasks.ts                  # ❌ Not colocated
lib/queries/task-queries.ts        # ❌ Disconnected
```

## When to Colocate vs Share

### ✅ Colocate When

- Component is only used by one page
- Hook fetches data specific to one route
- Query is only called from one page

```
app/(app)/[orgId]/vendors/
├── components/
│   └── VendorTable.tsx         # Only used on vendors page
├── hooks/
│   └── useVendors.ts           # Only used here
└── page.tsx
```

### ✅ Share When

- Component is used across 3+ pages
- Utility is genuinely generic
- Hook is reused across multiple routes

```
# Shared components live in:
src/components/ui/              # shadcn primitives
src/components/shared/          # cross-page components

# Shared hooks live in:
src/hooks/                      # e.g., useApiSWR, useDebounce
```

## Rules

1. **Default to colocating** - Start by putting files next to the page
2. **Move to shared only when reused** - Don't pre-optimize
3. **Remove unused imports** - Always clean up after refactoring
4. **One component per file** - Name file same as component

## Examples

### ✅ Creating a New Feature

```tsx
// app/(app)/[orgId]/risks/page.tsx
import { RiskTable } from './components/RiskTable';
import { getRisks } from './data/queries';

export default async function RisksPage({ params }) {
  const { orgId } = await params;
  const risks = await getRisks(orgId);
  return <RiskTable risks={risks} organizationId={orgId} />;
}
```

```tsx
// app/(app)/[orgId]/risks/components/RiskTable.tsx
'use client';
import { useRisks } from '../hooks/useRisks';
// ... component implementation
```

### ❌ Anti-Pattern: Global Everything

```tsx
// Don't do this:
import { RiskTable } from '@/components/risks/RiskTable';
import { useRisks } from '@/hooks/useRisks';
import { getRisks } from '@/lib/queries/risks';
```

## Checklist

Before committing:

- [ ] New components live next to their page
- [ ] Hooks are colocated with the page that uses them
- [ ] Shared code is genuinely used by 3+ pages
- [ ] No unused imports remain
- [ ] File names match component/hook names
