# Commit Message Rules

When generating commit messages, ALWAYS follow the Conventional Commits specification:

## Format

`<type>(<scope>): <description>`

## Types (use exactly these):

- feat: A new feature
- fix: A bug fix
- docs: Documentation only changes
- style: Changes that do not affect the meaning of the code (formatting, missing semi-colons, etc)
- refactor: A code change that neither fixes a bug nor adds a feature
- perf: A code change that improves performance
- test: Adding missing tests or correcting existing tests
- build: Changes that affect the build system or external dependencies
- ci: Changes to CI configuration files and scripts
- chore: Other changes that don't modify src or test files
- revert: Reverts a previous commit

## Rules:

1. Use lowercase for type
2. Scope is optional but recommended (e.g., auth, api, ui, db)
3. Description must be in imperative mood ("add" not "added" or "adds")
4. Description must start with lowercase
5. No period at the end of the description
6. Keep the first line under 72 characters

## Examples:

- ✅ feat(auth): add social login with Google OAuth
- ✅ fix(api): resolve race condition in user update endpoint
- ✅ chore: update dependencies to latest versions
- ✅ docs(readme): add installation instructions for Windows
- ❌ Added new feature (missing type)
- ❌ feat: Added login (wrong tense, capitalized)
- ❌ fix(api): fixes bug. (wrong tense, has period)

# Testing Rules

When working on the API (`apps/api`), follow these testing guidelines:

## When to Write Tests

1. **New features**: Every new service, controller, or significant function MUST have accompanying unit tests
2. **Bug fixes**: Add a test that reproduces the bug before fixing it
3. **Refactoring**: Ensure existing tests pass; add tests if coverage is lacking

## When to Run Tests

Run tests after significant changes:

```bash
# Run tests for a specific module
npx jest src/<module-name> --passWithNoTests

# Run all API tests
npx turbo run test --filter=@comp/api

# Run tests in watch mode during development
npx jest --watch
```

## Test File Conventions

- Place test files next to the source file: `foo.service.ts` → `foo.service.spec.ts`
- Use Jest and NestJS testing utilities
- Mock external dependencies (database, external APIs)
- Test both success and error cases

## Minimum Test Coverage

For new code in `apps/api/src`:
- Services: Test all public methods, including error handling
- Controllers: Test endpoint routing and parameter passing
- Guards: Test authorization logic
- Utils: Test edge cases and error conditions

## Example Test Structure

```typescript
describe('MyService', () => {
  describe('myMethod', () => {
    it('should handle success case', async () => { ... });
    it('should throw on invalid input', async () => { ... });
    it('should handle edge case X', async () => { ... });
  });
});
```
